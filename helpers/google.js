"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const rrule_1=require("rrule");function findValueInHeaders(e,n,o=!0){let r="";return n.forEach(n=>{n.name==e&&(r=n.value)}),o&&(r=decodeURIComponent(JSON.parse(r))),r}function convertToGoogleMessage(e){var n;let o="";o=`to: ${e.to.join(",")}\n`+(e.cc?`cc: ${e.cc.join(",")}\n`:"")+(e.bcc?`bcc: ${null===(n=e.bcc)||void 0===n?void 0:n.join(",")}\n`:"")+`subject: ${e.subject}\n\n`+(""+e.body);return{raw:Buffer.from(o).toString("base64")}}function convertToEvent(e){var n,o,r,t,i,a,c,l,d;const{creator:s,organizer:u,summary:v,start:m,end:g,location:p,attendees:f,description:T,id:y,recurringEventId:E,htmlLink:b,hangoutLink:j,originalStartTime:D,status:h}=e;try{return{id:y,organizerName:null===(n=s)||void 0===n?void 0:n.displayName,subject:v,status:h,startTime:new Date((null===(o=m)||void 0===o?void 0:o.dateTime)||(null===(r=m)||void 0===r?void 0:r.date)||(null===(t=D)||void 0===t?void 0:t.dateTime))||new Date,endTime:new Date((null===(i=g)||void 0===i?void 0:i.dateTime)||(null===(a=g)||void 0===a?void 0:a.date)||(null===(c=D)||void 0===c?void 0:c.dateTime)),location:p||"",meetingLink:j||"",attendees:f?f.map(e=>{var n,o,r;return{name:null===(n=e)||void 0===n?void 0:n.displayName,email:null===(o=e)||void 0===o?void 0:o.email,reponse:null===(r=e)||void 0===r?void 0:r.responseStatus}}):[],content:T,organizer:{name:null===(l=u)||void 0===l?void 0:l.displayName,email:null===(d=u)||void 0===d?void 0:d.email},recurrence:getRecurrenceDetails(e),recurrenceId:E,calendarLink:b}}catch(e){return console.log(e),void console.log("Failed to Convert Event for "+y)}}function convertToEventsArray(e){return e.map(convertToEvent).filter(e=>void 0!==e)}function getRecurrenceDetails(e){const{recurrence:n}=e,o=[];if(n){const r=n.join("\n");try{const e=rrule_1.rrulestr(r);o.push(e.toString())}catch(n){console.log("Failing to add recurrence repeat for: "+e.id),console.error(n)}}return o}exports.findValueInHeaders=findValueInHeaders,exports.convertToGoogleMessage=convertToGoogleMessage,exports.convertToEvent=convertToEvent,exports.convertToEventsArray=convertToEventsArray,exports.getRecurrenceDetails=getRecurrenceDetails;