"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const libmon_1=require("libmon"),track_1=require("./models/track"),services_1=require("./services"),calendar_1=require("./services/calendar/calendar"),task_1=require("./services/tasks/task"),team_1=__importDefault(require("./services/team/team"));class Connector{constructor(e,t){this.opts=e,this.authorizers={},this.subscriptions=[],this.authorizers=e.authorizers||{},libmon_1.Libmon.initialize("integrations"),libmon_1.Libmon.validate(t),this.setupLibmon()}setupLibmon(){libmon_1.Libmon.setupCounter(track_1.DemoCounter.MailActions,10),libmon_1.Libmon.setupCounter(track_1.DemoCounter.CalendarActions,10),libmon_1.Libmon.setupCounter(track_1.DemoCounter.TaskServices,1)}addAuthorizer(e,t){return this.authorizers[e]=t}getAuthorizers(){return this.authorizers}trackItem(e){return this.subscriptions.push(e)}getMailService(e){const{authorizers:t}=this;return new services_1.MailService(e,{authorizers:t,onSubscription:this.onSubscriptionChanged})}getCalendarService(e){const{authorizers:t}=this;return new calendar_1.CalendarService(e,{authorizers:t,onSubscription:this.onSubscriptionChanged})}getTaskService(e){libmon_1.Libmon.increment(track_1.DemoCounter.TaskServices);const{authorizers:t}=this;return new task_1.TaskService(e,{authorizers:t,onSubscription:this.onSubscriptionChanged})}getTeamService(e){const{authorizers:t}=this;return new team_1.default(e,{authorizers:t,onSubscription:this.onSubscriptionChanged})}stopTrackingItem(e){}onSubscriptionChanged(e,t){if(this.opts.onSubscriptionChanged)return this.opts.onSubscriptionChanged(e,t)}}exports.Connector=Connector;