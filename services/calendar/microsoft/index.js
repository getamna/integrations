"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{d(i.next(t))}catch(t){o(t)}}function s(t){try{d(i.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}d((i=i.apply(t,e||[])).next())}))},__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(exports,"__esModule",{value:!0});const MicrosoftHelper=__importStar(require("../../../helpers/microsoft")),__1=require("..");class Microsoft extends __1.CalendarInterface{constructor(t,e){super(t,e),this.opts=e,this.httpClient.defaults.baseURL="https://graph.microsoft.com/v1.0/me/"}getEventById(t){return __awaiter(this,void 0,void 0,(function*(){const e=(yield this.httpClient.get("events/"+t)).data;return MicrosoftHelper.convertToEvent(e)}))}getEventFromRange(t,e,n){return __awaiter(this,void 0,void 0,(function*(){const i=n?`calendarview?startdatetime=${t.toISOString()}&enddatetime=${e.toISOString()}`:`events?$filter=start/dateTime ge '${t.toISOString()}' and start/dateTime lt '${e.toISOString()}'&$orderby=Start/DateTime`,r=(yield this.httpClient.get(i)).data.value;return MicrosoftHelper.convertToEventsArray(r)}))}createEvent(t){return __awaiter(this,void 0,void 0,(function*(){const{subject:e,startTime:n,endTime:i,attendees:r,isOnlineMeeting:o,onlineMeetingProvider:a,body:s,timeZone:d,type:c}=t,u={subject:e,body:{contentType:"HTML",content:s},start:{dateTime:n.toISOString(),timeZone:d||""},end:{dateTime:i.toISOString(),timeZone:d||""},attendees:r.map(t=>({emailAddress:{address:t.email,name:t.name},type:c||""})),isOnlineMeeting:o||!1,onlineMeetingProvider:a||""},l=yield this.httpClient.post("events",u,{timeout:5e3});if(201==l.status){return l.data.id}return"event not created"}))}updateEvent(t,e){return __awaiter(this,void 0,void 0,(function*(){const{subject:n,startTime:i,endTime:r,attendees:o,isOnlineMeeting:a,onlineMeetingProvider:s,body:d,timeZone:c,type:u}=e,l={subject:n,body:{contentType:"HTML",content:d},start:{dateTime:i.toISOString(),timeZone:c},end:{dateTime:r.toISOString(),timeZone:c},attendees:o?o.map(t=>({emailAddress:{address:t.email,name:t.name},type:u||""})):[],isOnlineMeeting:a,onlineMeetingProvider:s},m=yield this.httpClient.patch("events/"+t,l);if(200==m.status){return m.data.id}return""}))}deleteEventById(t){return __awaiter(this,void 0,void 0,(function*(){return 204==(yield this.httpClient.delete("events/"+t)).status}))}}exports.Microsoft=Microsoft;