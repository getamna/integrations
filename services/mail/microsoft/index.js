"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,s){return new(r||(r=Promise))((function(o,i){function n(t){try{d(s.next(t))}catch(t){i(t)}}function a(t){try{d(s.throw(t))}catch(t){i(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,a)}d((s=s.apply(t,e||[])).next())}))},__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(exports,"__esModule",{value:!0});const __1=require(".."),MicrosoftHelper=__importStar(require("../../../helpers/microsoft"));class Microsoft extends __1.MailInterface{constructor(t,e){super(t,e),this.opts=e,this.httpClient.defaults.baseURL="https://graph.microsoft.com/v1.0/me/"}send(t){return __awaiter(this,void 0,void 0,(function*(){const e={message:{subject:t.subject,body:{contentType:"HTML",content:t.body},toRecipients:t.to.map(t=>({emailAddress:{address:t}}))}};return(yield this.httpClient.post("sendMail",e)).status,""}))}saveDraft(t){return __awaiter(this,void 0,void 0,(function*(){const e={Subject:t.subject,Importance:"Low",Body:{ContentType:"HTML",Content:t.body},ToRecipients:t.to.map(t=>({EmailAddress:{Address:t}}))};return 201==(yield this.httpClient.post("messages",e)).status}))}getThread(t){throw new Error("Method not implemented.")}getMessage(t){return __awaiter(this,void 0,void 0,(function*(){const e=(yield this.httpClient.get("messages/"+t)).data;return{id:e.id,body:e.body.content,subject:e.subject,from:{name:e.from.emailAddress.name,email:e.from.emailAddress.address},to:e.toRecipients.map(t=>({name:t.emailAddress.name,email:t.emailAddress.address}))}}))}searchMail(t){return __awaiter(this,void 0,void 0,(function*(){const e={requests:[{entityTypes:["message"],query:{queryString:t},from:0,size:25,enableTopResults:!1}]},r=(yield this.httpClient({method:"post",url:"search/query",baseURL:"https://graph.microsoft.com/beta/",data:e})).data.value[0];if(!r)return[];return MicrosoftHelper.convertToMessageArray(r)}))}getFolder(t){return __awaiter(this,void 0,void 0,(function*(){throw new Error("Method not implemented.")}))}getThreads(t){throw new Error("Method not implemented.")}}exports.Microsoft=Microsoft;