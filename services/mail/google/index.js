"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(a,s){function i(e){try{l(r.next(e))}catch(e){s(e)}}function n(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,n)}l((r=r.apply(e,t||[])).next())}))},__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const __1=require(".."),GoogleHelper=__importStar(require("../../../helpers/google"));class Google extends __1.MailInterface{constructor(e,t){super(e,t),this.opts=t,this.httpClient.defaults.baseURL="https://gmail.googleapis.com/gmail/v1/users/me/"}send(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.httpClient.post("messages/send",GoogleHelper.convertToGoogleMessage(e));if(200==t.status){return t.data.id}return""}))}saveDraft(e){return __awaiter(this,void 0,void 0,(function*(){const t={id:"",message:GoogleHelper.convertToGoogleMessage(e)};return 200==(yield this.httpClient.post("drafts",t)).status}))}getThread(e){throw new Error("Method not implemented.")}searchMail(e,t=25){return __awaiter(this,void 0,void 0,(function*(){const o=(yield this.httpClient.get(`messages?q=${e}&maxResults=${t}`)).data,r=[],a=[];o.messages.forEach(e=>{r.push(e.id)}),r.forEach(e=>{a.push(this.getMessage(e))});return yield Promise.all(a)}))}getMessage(e){return __awaiter(this,void 0,void 0,(function*(){const t=(yield this.httpClient.get("messages/"+e)).data;return{id:t.id,body:t.payload.parts.map(e=>Buffer.from(e.body.data,"base64").toString("ascii")).join(" "),subject:GoogleHelper.findValueInHeaders("subject",t.payload.headers),from:{name:GoogleHelper.findValueInHeaders("from",t.payload.headers),email:GoogleHelper.findValueInHeaders("from",t.payload.headers)},to:[{name:GoogleHelper.findValueInHeaders("to",t.payload.headers),email:GoogleHelper.findValueInHeaders("to",t.payload.headers)}]}}))}getFolder(e){throw new Error("Method not implemented.")}getThreads(e){throw new Error("Method not implemented.")}}exports.Google=Google;